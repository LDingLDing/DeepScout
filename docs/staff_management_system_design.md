# Staff 后台管理系统设计文档

## 一、系统概述

### 1.1 背景与目标

InfoRadar（信息雷达）系统需要一个专门的后台管理界面，供内部工作人员（Staff）管理系统核心资源，包括账号、信息源、采集任务和执行日志。本文档详细描述该 Staff 后台管理系统的设计方案。

### 1.2 核心功能

1. **账号管理**：Staff 账号的创建、登录、权限控制和密码管理
2. **信息源管理**：信息源的增删改查（CRUD）操作
3. **采集任务管理**：采集任务的增删改查（CRUD）操作，包括版本管理
4. **执行日志查看**：查看和筛选采集任务的执行日志

### 1.3 用户角色

| 角色 | 描述 | 权限范围 |
|------|------|----------|
| 超级管理员 | 系统最高权限用户 | 所有功能，包括 Staff 账号管理 |
| 运营管理员 | 负责日常运营的管理员 | 信息源、采集任务和日志管理，不能管理 Staff 账号 |
| 只读用户 | 仅有查看权限的用户 | 只能查看各模块数据，无修改权限 |

## 二、系统架构

### 2.1 技术栈

- **前端**：React + Next.js + Ant Design
- **后端**：NestJS + TypeScript
- **数据库**：PostgreSQL
- **认证**：JWT (JSON Web Token)

### 2.2 系统模块

```
Staff后台
├── 账号管理模块
│   ├── 登录/注销
│   ├── 账号列表
│   ├── 账号创建
│   ├── 账号编辑
│   └── 权限管理
├── 信息源管理模块
│   ├── 信息源列表
│   ├── 信息源创建
│   ├── 信息源编辑
│   └── 信息源删除
├── 采集任务管理模块
│   ├── 任务列表
│   ├── 任务创建
│   ├── 任务编辑
│   ├── 任务版本管理
│   └── 任务状态控制
└── 日志管理模块
    ├── 日志列表
    ├── 日志详情
    └── 日志筛选
```

### 2.3 项目目录结构

```
inforadar/
├── staff/              # 后台管理系统
│   ├── frontend/       # Next.js前端应用
│   │   ├── src/        # 源代码
│   │   │   ├── components/ # UI组件
│   │   │   ├── pages/      # 页面路由
│   │   │   ├── hooks/      # 自定义Hooks
│   │   │   ├── services/   # API服务
│   │   │   └── utils/      # 工具函数
│   │   └── public/         # 静态资源
│   │
│   └── backend/        # NestJS后端服务
│       ├── src/        # 源代码
│       │   ├── modules/    # 业务模块
│       │   ├── entities/   # 数据实体
│       │   ├── services/   # 服务层
│       │   ├── resolvers/  # GraphQL解析器
│       │   └── utils/      # 工具函数
│       └── test/           # 测试
```

## 三、数据库设计

### 3.1 Staff 账号表设计

新增 `staff` 表用于管理后台账号：

| 字段名 | 类型 | 必填 | 默认值 | 描述 | 索引 |
|--------|------|------|--------|------|------|
| `staffid` | INT | 是 | 自增 | 员工唯一ID | 主键 |
| `username` | VARCHAR(50) | 是 | - | 登录用户名 | 唯一索引 |
| `password` | VARCHAR(100) | 是 | - | 加密后的密码 | - |
| `name` | VARCHAR(50) | 是 | - | 员工姓名 | - |
| `role` | ENUM('super_admin','admin','readonly') | 是 | 'readonly' | 角色类型 | - |
| `status` | ENUM('active','inactive') | 是 | 'active' | 账号状态 | - |
| `last_login` | DATETIME | 否 | NULL | 最后登录时间 | - |
| `created_at` | DATETIME | 否 | CURRENT_TIMESTAMP | 创建时间 | - |
| `updated_at` | DATETIME | 否 | ON UPDATE CURRENT_TIMESTAMP | 更新时间 | - |

## 四、功能模块详细设计

### 4.1 账号管理模块

#### 4.1.1 登录界面

![登录界面示意图](示意图链接)

- **功能**：用户名密码登录，记住登录状态选项
- **安全措施**：
  - 密码加盐哈希存储
  - 登录失败次数限制
  - 验证码机制（连续失败3次后启用）

#### 4.1.2 账号列表

- **展示内容**：
  - 用户名、姓名、角色、状态、最后登录时间、创建时间
  - 分页展示，默认每页20条
  - 支持按用户名、姓名、角色筛选
- **操作**：
  - 新建账号（仅超级管理员）
  - 编辑账号（仅超级管理员）
  - 禁用/启用账号（仅超级管理员）
  - 重置密码（仅超级管理员）

#### 4.1.3 账号创建/编辑

- **表单字段**：
  - 用户名（创建后不可修改）
  - 密码（创建时必填，编辑时可选）
  - 姓名
  - 角色选择
  - 状态选择

### 4.2 信息源管理模块

#### 4.2.1 信息源列表

- **展示内容**：
  - 信息源ID、名称、关联任务数量、创建时间、更新时间
  - 分页展示，默认每页20条
  - 支持按ID、名称搜索
- **操作**：
  - 新建信息源
  - 编辑信息源
  - 删除信息源（需二次确认，并提示关联影响）
  - 查看关联任务

#### 4.2.2 信息源创建/编辑

- **表单字段**：
  - 信息源名称
  - 描述信息（可选）
  - 其他元数据（可选）

### 4.3 采集任务管理模块

#### 4.3.1 任务列表

- **展示内容**：
  - 任务ID、关联信息源、信息源类型、当前版本、创建时间
  - 分页展示，默认每页15条
  - 支持按信息源名称、类型筛选
- **操作**：
  - 新建任务
  - 编辑任务（创建新版本）
  - 查看任务历史版本
  - 查看任务执行日志
  - 禁用/启用任务

#### 4.3.2 任务创建/编辑

- **表单字段**：
  - 关联信息源（下拉选择）
  - 信息源类型（web/rss/wechat）
  - 采集代码（支持代码编辑器，语法高亮）
  - 版本说明（可选）

#### 4.3.3 任务版本管理

- **展示内容**：
  - 版本号、创建时间、创建人
  - 版本间代码差异对比
- **操作**：
  - 查看特定版本代码
  - 回滚到历史版本（创建新版本）

### 4.4 日志管理模块

#### 4.4.1 日志列表

- **展示内容**：
  - 任务ID、信息源名称、执行时间、执行状态、耗时
  - 分页展示，默认每页30条
  - 高级筛选：时间范围、状态、信息源、任务ID
- **操作**：
  - 查看日志详情
  - 导出日志（CSV格式）

#### 4.4.2 日志详情

- **展示内容**：
  - 基本信息：任务ID、信息源、执行时间、状态
  - 执行详情：开始时间、结束时间、耗时
  - 输出内容：执行输出、错误信息（如有）
  - 任务代码：执行时的任务代码版本

## 五、界面设计

### 5.1 整体布局

- **顶部导航栏**：Logo、系统名称、当前用户信息、注销按钮
- **左侧菜单**：各功能模块入口，根据用户权限动态显示
- **主内容区**：功能操作界面
- **页脚**：版权信息、系统版本

### 5.2 配色方案

- **主色调**：#1890ff（蓝色）
- **辅助色**：#52c41a（绿色）、#faad14（黄色）、#f5222d（红色）
- **背景色**：#f0f2f5（浅灰色）

### 5.3 响应式设计

- 支持桌面端（1920×1080、1366×768）
- 支持平板端（iPad Pro、iPad）
- 不优先支持移动端

## 六、安全设计

### 6.1 认证与授权

- **认证机制**：JWT（JSON Web Token）
  - Token有效期：2小时
  - 支持刷新Token
- **授权控制**：
  - 基于角色的访问控制（RBAC）
  - API级别权限校验
  - 前端UI级别权限控制

### 6.2 数据安全

- **密码安全**：
  - bcrypt加密存储
  - 定期强制修改密码（90天）
- **操作审计**：
  - 记录关键操作日志（账号创建、信息源删除等）
  - 日志包含操作人、操作时间、IP地址

### 6.3 防攻击措施

- **防SQL注入**：使用参数化查询
- **防XSS攻击**：输入过滤，输出编码
- **防CSRF攻击**：使用CSRF Token
- **请求限流**：API访问频率限制

## 七、性能优化

### 7.1 前端优化

- 组件懒加载
- 大型列表虚拟滚动
- 静态资源CDN加速

### 7.2 后端优化

- API响应缓存
- 数据库查询优化
- 分页查询限制

## 八、部署方案

### 8.1 环境配置

- **开发环境**：dev.inforadar.com/staff
- **测试环境**：test.inforadar.com/staff
- **生产环境**：inforadar.com/staff

### 8.2 部署架构

- Nginx反向代理
- Node.js应用服务器
- MySQL数据库服务器
- Redis缓存服务器

## 九、测试计划

### 9.1 测试类型

- 单元测试
- 接口测试
- UI测试
- 性能测试
- 安全测试

### 9.2 测试覆盖率目标

- 代码覆盖率 > 80%
- 接口覆盖率 = 100%
- 关键流程覆盖率 = 100%

## 十、迭代计划

### 10.1 第一期（基础版）

- 账号登录
- 信息源基础管理
- 采集任务基础管理
- 简单日志查看

### 10.2 第二期（完善版）

- 完整权限管理
- 任务版本对比
- 高级日志筛选
- 数据统计报表

### 10.3 第三期（高级版）

- 任务调度管理
- 告警配置
- 系统监控
- 数据可视化

## 十一、附录

### 11.1 术语表

| 术语 | 定义 |
|------|------|
| Staff | 系统内部工作人员 |
| 信息源 | 需要采集信息的来源，如网站、RSS、公众号 |
| 采集任务 | 针对特定信息源的数据采集代码 |
| 任务版本 | 采集任务代码的不同版本 |

### 11.2 参考文档

- 数据库设计文档
- API接口文档
- UI设计规范

---

*文档版本：v1.0*  
*最后更新：2025年3月4日*  
*作者：InfoRadar团队*
