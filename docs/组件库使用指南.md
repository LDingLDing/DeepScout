# 组件库使用指南

## 概述

前端使用 React 和 Ant Design 构建，本指南提供了项目中常用组件的使用方法和最佳实践，帮助开发者快速上手并保持代码风格一致性。

## 布局组件

### MainLayout

`MainLayout` 是应用的主布局组件，提供了响应式的导航结构和内容区域。

#### 用法

```tsx
import MainLayout from '@/components/Layout/MainLayout';

export default function Page() {
  return (
    <MainLayout>
      <div>页面内容</div>
    </MainLayout>
  );
}
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| children | ReactNode | - | 内容区域 |
| selectedKey | string | '1' | 当前选中的菜单项 |

#### 响应式行为

- 在移动设备上（< 768px）显示为抽屉式导航
- 在桌面设备上（≥ 768px）显示为侧边栏导航

### PageHeader

`PageHeader` 提供统一的页面标题和操作区域。

#### 用法

```tsx
import PageHeader from '@/components/Layout/PageHeader';

<PageHeader 
  title="页面标题" 
  extra={<Button type="primary">操作按钮</Button>} 
/>
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| title | string | - | 页面标题 |
| subtitle | string | - | 页面副标题 |
| extra | ReactNode | - | 额外的操作区域 |
| backButton | boolean | false | 是否显示返回按钮 |
| onBack | () => void | - | 返回按钮点击事件 |

## 任务相关组件

### TaskList

`TaskList` 组件用于展示任务列表，支持响应式布局。

#### 用法

```tsx
import TaskList from '@/components/Tasks/TaskList';

<TaskList 
  tasks={tasks} 
  loading={isLoading} 
  onTaskClick={(id) => router.push(`/tasks/${id}`)} 
/>
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| tasks | Task[] | [] | 任务数据数组 |
| loading | boolean | false | 加载状态 |
| onTaskClick | (id: string) => void | - | 任务点击事件 |
| onDeleteTask | (id: string) => void | - | 任务删除事件 |
| onRunTask | (id: string) => void | - | 运行任务事件 |
| onPauseTask | (id: string) => void | - | 暂停任务事件 |

#### 响应式行为

- 在移动设备上显示为列表视图
- 在桌面设备上显示为表格视图

### TaskDetail

`TaskDetail` 组件用于展示任务详细信息，包括基本信息、监控目标和执行结果。

#### 用法

```tsx
import TaskDetail from '@/components/Tasks/TaskDetail';

<TaskDetail 
  task={task} 
  onRefresh={refetch} 
  tabView="basic" // 移动端使用
/>
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| task | Task | - | 任务数据 |
| onRefresh | () => void | - | 刷新数据方法 |
| tabView | 'basic' \| 'targets' \| 'results' | undefined | 移动端标签视图 |

#### 响应式行为

- 在移动设备上通过 `tabView` 属性分别显示不同部分
- 在桌面设备上完整显示所有信息

### TaskForm

`TaskForm` 组件用于创建和编辑任务，支持分步表单。

#### 用法

```tsx
import TaskForm from '@/components/Tasks/TaskForm';

<TaskForm 
  initialValues={task} // 编辑模式传入
  onSubmit={handleSubmit}
  loading={isSubmitting}
  isEdit={true} // 编辑模式
/>
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| initialValues | Task | undefined | 初始值（编辑模式） |
| onSubmit | (values: TaskCreateInput \| TaskUpdateInput) => void | - | 提交表单回调 |
| loading | boolean | false | 提交状态 |
| isEdit | boolean | false | 是否为编辑模式 |

#### 响应式行为

- 在移动设备上显示为分步表单
- 在桌面设备上可一次性显示所有表单项

## 数据展示组件

### StatCard

`StatCard` 组件用于展示统计数据卡片。

#### 用法

```tsx
import StatCard from '@/components/Dashboard/StatCard';

<StatCard 
  title="活跃任务" 
  value={10} 
  icon={<BugOutlined />} 
  trend={15} 
/>
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| title | string | - | 卡片标题 |
| value | number \| string | - | 显示的值 |
| icon | ReactNode | - | 图标 |
| trend | number | undefined | 趋势变化百分比 |
| loading | boolean | false | 加载状态 |
| color | string | - | 卡片主题色 |

### ResultView

`ResultView` 组件用于展示任务执行结果。

#### 用法

```tsx
import ResultView from '@/components/Tasks/ResultView';

<ResultView 
  results={task.results} 
  onExport={handleExport} 
/>
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| results | TaskResult[] | [] | 结果数据 |
| loading | boolean | false | 加载状态 |
| onExport | () => void | - | 导出按钮点击事件 |
| onRefresh | () => void | - | 刷新按钮点击事件 |

#### 响应式行为

- 在移动设备上使用折叠面板展示结果
- 在桌面设备上使用表格展示结果

## 表单组件

### SearchBar

`SearchBar` 组件提供搜索功能。

#### 用法

```tsx
import SearchBar from '@/components/Common/SearchBar';

<SearchBar 
  placeholder="搜索任务..." 
  onSearch={handleSearch} 
  allowClear 
/>
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| placeholder | string | '搜索...' | 占位文本 |
| onSearch | (value: string) => void | - | 搜索回调 |
| allowClear | boolean | true | 是否显示清除按钮 |
| loading | boolean | false | 加载状态 |
| defaultValue | string | '' | 默认值 |

### FilterDropdown

`FilterDropdown` 组件提供下拉筛选功能。

#### 用法

```tsx
import FilterDropdown from '@/components/Common/FilterDropdown';

<FilterDropdown 
  options={[
    { label: '全部', value: 'all' },
    { label: '运行中', value: 'running' },
    { label: '已暂停', value: 'paused' }
  ]}
  value={filter}
  onChange={setFilter}
/>
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| options | { label: string, value: string }[] | [] | 选项数组 |
| value | string | - | 当前选中值 |
| onChange | (value: string) => void | - | 值变化回调 |
| placeholder | string | '筛选' | 占位文本 |

## 反馈组件

### LoadingState

`LoadingState` 组件用于展示加载状态。

#### 用法

```tsx
import LoadingState from '@/components/Common/LoadingState';

{isLoading ? (
  <LoadingState text="加载中..." />
) : (
  <div>内容</div>
)}
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| text | string | '加载中...' | 加载文本 |
| size | 'small' \| 'default' \| 'large' | 'default' | 加载图标大小 |
| fullPage | boolean | false | 是否全页加载 |

### EmptyState

`EmptyState` 组件用于展示空状态。

#### 用法

```tsx
import EmptyState from '@/components/Common/EmptyState';

{tasks.length === 0 && !isLoading && (
  <EmptyState 
    description="暂无任务" 
    button={<Button type="primary">创建任务</Button>} 
  />
)}
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| description | string | '暂无数据' | 描述文本 |
| image | ReactNode | - | 自定义图片 |
| button | ReactNode | - | 操作按钮 |

### ErrorState

`ErrorState` 组件用于展示错误状态。

#### 用法

```tsx
import ErrorState from '@/components/Common/ErrorState';

{error && (
  <ErrorState 
    error={error} 
    onRetry={refetch} 
  />
)}
```

#### 属性

| 属性名 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| error | Error \| string | - | 错误信息 |
| onRetry | () => void | - | 重试回调 |

## 响应式开发指南

### 使用 Grid 系统

利用 Ant Design 的 Grid 系统检测屏幕尺寸：

```tsx
import { Grid } from 'antd';
const { useBreakpoint } = Grid;

function Component() {
  const screens = useBreakpoint();
  
  return (
    <div>
      {screens.md ? (
        <PCVersionComponent />
      ) : (
        <MobileVersionComponent />
      )}
    </div>
  );
}
```

### 响应式布局

使用 Row 和 Col 组件创建响应式布局：

```tsx
<Row gutter={[16, 16]}>
  <Col xs={24} sm={24} md={12} lg={8} xl={6}>
    <Card>内容1</Card>
  </Col>
  <Col xs={24} sm={24} md={12} lg={8} xl={6}>
    <Card>内容2</Card>
  </Col>
  <Col xs={24} sm={24} md={12} lg={8} xl={6}>
    <Card>内容3</Card>
  </Col>
</Row>
```

### 条件渲染

根据屏幕尺寸条件渲染不同组件：

```tsx
{screens.md ? (
  <Table columns={columns} dataSource={data} />
) : (
  <List
    dataSource={data}
    renderItem={(item) => (
      <List.Item>
        <List.Item.Meta
          title={item.title}
          description={item.description}
        />
      </List.Item>
    )}
  />
)}
```

## 主题与样式

### 全局样式变量

项目使用 Less 变量定义全局样式：

```less
// styles/variables.less
@primary-color: #1890ff;
@border-radius-base: 4px;
@font-size-base: 14px;
@heading-color: rgba(0, 0, 0, 0.85);
@text-color: rgba(0, 0, 0, 0.65);
```

### 组件样式覆盖

覆盖 Ant Design 组件样式：

```less
// styles/overrides.less
.ant-btn {
  &.ant-btn-primary {
    background-color: @primary-color;
    border-color: @primary-color;
  }
}

// 移动端特定样式
@media (max-width: 767px) {
  .ant-card {
    .ant-card-body {
      padding: 12px;
    }
  }
}
```

## 最佳实践

1. **组件拆分**：将复杂组件拆分为小型、可复用的组件
2. **统一数据流**：使用 React Query 管理服务器状态
3. **类型安全**：使用 TypeScript 接口定义组件属性
4. **移动优先**：先设计移动端界面，再扩展到桌面端
5. **性能优化**：使用 React.memo、useMemo 和 useCallback 优化性能
6. **错误边界**：使用错误边界捕获组件错误
7. **可访问性**：确保组件符合 WCAG 标准

---

© 2025 InfoRadar 信息雷达 | 版本：1.0.0
